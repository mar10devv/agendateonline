---
export const prerender = false;

import BarberiaLayout from "../../layouts/BarberiaLayout.astro";
import NavbarBarberia from "../../components/barberia/NavbarBarberia";
import HeroBarberia from "../../components/barberia/HeroBarberia";
import ServiciosBarberia from "../../components/barberia/ServiciosBarberia";
import SobreNosotros from "../../components/barberia/SobreNosotros";
import Resenas from "../../components/barberia/Resenas";
import FooterBarberia from "../../components/barberia/FooterBarberia"
import AgendarTurno from "../../components/barberia/AgendarTurno"


import { db } from "../../lib/firebase";
import { collection, query, where, getDocs } from "firebase/firestore";
import { fuentesMap, fuentesStyle } from "../../lib/fonts";

const { slug } = Astro.params;

let negocio = null;
const q = query(collection(db, "Negocios"), where("slug", "==", slug));
const snap = await getDocs(q);

if (!snap.empty) {
  negocio = snap.docs[0].data();
}

const hoverColor = negocio?.hoverColor || "#3b82f6";
const fuenteLogo = negocio?.fuenteLogo || "montserrat";
const fuenteBotones = negocio?.fuenteBotones || "poppins";
const fuenteTexto = negocio?.fuenteTexto || "raleway";

const modoImagenes = negocio?.modoImagenes || "defecto";

const heroImages =
  modoImagenes === "personalizado" && negocio?.bannerImages?.length
    ? negocio.bannerImages
    : ["/img/1.jpeg", "/img/2.jpg", "/img/3.jpg"];

const css = `
  :root {
    --hoverColor: ${hoverColor};
    --logoFont: ${fuentesStyle[fuenteLogo] || "sans-serif"};
  }

  .negocio a,
  .negocio button {
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  .negocio a:hover,
  .negocio button:hover {
    background-color: var(--hoverColor);
    color: white;
    border-color: var(--hoverColor);
  }
`;
---

{!negocio ? (
  <h1 class="text-center text-2xl mt-10">‚ùå Este negocio no existe.</h1>
) : (
  <BarberiaLayout title={negocio.nombre}>
    <!-- üé® Inyectar estilos din√°micos -->
    <style is:global>{css}</style>

    <!-- ‚úÖ Navbar -->
    <NavbarBarberia
      title={negocio.nombre}
      hoverColor={hoverColor}
      logoUrl={negocio.usarLogo ? negocio.logoUrl : null}
      fuenteLogo={fuenteLogo}
      fuenteTexto={fuenteTexto}
      fuenteBotones={fuenteBotones}
      client:load
    />

    <!-- ‚úÖ Hero -->
    <HeroBarberia
      client:load
      images={heroImages}
      modoImagenes={modoImagenes}
      nombre={negocio.nombre}
      eslogan={negocio.eslogan}
      fuenteLogo={fuenteLogo}
      fuenteTexto={fuenteTexto}
      fuenteBotones={fuenteBotones}
    />
    <!-- üöÄ Nueva secci√≥n Servicios -->
<div id="servicios">
  <ServiciosBarberia 
    fuenteTexto={fuenteTexto} 
    fuenteBotones={fuenteBotones} 
    client:load 
  />
</div>

<!-- üöÄ Nueva secci√≥n Sobre Nosotros -->
<div id="sobre-nosotros" class="mt-20">
  <SobreNosotros 
    fuenteTexto={fuenteTexto} 
    fuenteBotones={fuenteBotones}
    client:load 
  />
</div>

<!-- üöÄ Nueva secci√≥n Agendar Turno -->
<div id="agendar-turno" class="mt-20">
  <AgendarTurno 
    empleados={negocio.empleadosData || []}
    fuenteTexto={fuenteTexto} 
    fuenteBotones={fuenteBotones}
    client:load 
  />
</div>

<!-- ‚úÖ Secci√≥n Rese√±as -->
<div id="rese√±as" class="mt-20">
  <Resenas 
    fuenteTexto={fuenteTexto} 
    fuenteBotones={fuenteBotones}
    client:load 
  />
</div>

<!-- ‚úÖ Footer -->
<FooterBarberia 
  fuenteTexto={fuenteTexto} 
  fuenteBotones={fuenteBotones}
  client:load 
/>

  </BarberiaLayout>
)}
