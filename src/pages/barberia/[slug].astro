---
export const prerender = false;

import BarberiaLayout from "../../layouts/BarberiaLayout.astro";
import NavbarBarberia from "../../components/barberia/NavbarBarberia";
import { db } from "../../lib/firebase";
import { collection, query, where, getDocs } from "firebase/firestore";

const { slug } = Astro.params;

// Buscar negocio en Firestore con ese slug
let negocio = null;
const q = query(collection(db, "Negocios"), where("slug", "==", slug));
const snap = await getDocs(q);

if (!snap.empty) {
  negocio = snap.docs[0].data();
}

const hoverColor = negocio?.hoverColor || "#3b82f6";

// üîß Estilos din√°micos como string
const css = `
  :root {
    --hoverColor: ${hoverColor};
  }

  .negocio a,
  .negocio button {
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  .negocio a:hover,
  .negocio button:hover {
    background-color: var(--hoverColor);
    color: white;
    border-color: var(--hoverColor);
  }
`;
---

{!negocio ? (
  <h1 class="text-center text-2xl mt-10">‚ùå Este negocio no existe.</h1>
) : (
  <BarberiaLayout title={negocio.nombre}>
    <!-- üé® Inyectar estilos din√°micos globales -->
    <style is:global set:html={css} />

    <!-- ‚úÖ Navbar din√°mico -->
    <NavbarBarberia
      title={negocio.nombre}
      hoverColor={hoverColor}
      logoUrl={negocio.usarLogo ? negocio.logoUrl : null}
      client:load
    />

    <!-- ‚úÖ Secci√≥n con botones -->
    <div class="negocio space-y-6 mt-6 p-6 border rounded bg-gray-50">
      <a
        href="#"
        class="inline-block px-4 py-2 border rounded font-medium"
      >
        Ver servicios
      </a>

      <button
        class="px-4 py-2 border rounded font-medium"
      >
        Reservar turno
      </button>

      <div class="border p-4 rounded shadow-sm hover:shadow-md">
        Tarjeta promocional de {negocio.nombre}
      </div>
    </div>
  </BarberiaLayout>
)}
